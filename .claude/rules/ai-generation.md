---
paths: "app/agents/**/*.py, app/utils/prompts.py, app/utils/post_types.py"
---

# AI Generation Rules

–ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å Claude API –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–æ–Ω—Ç–µ–Ω—Ç–∞.

## Proxy Configuration

Claude API –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –≤ –†–§. –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π proxy:

```python
from app.config import settings
import httpx
from anthropic import Anthropic

proxy_url = settings.proxy_url
if proxy_url:
    http_client = httpx.Client(proxies=proxy_url, timeout=60.0)
else:
    http_client = httpx.Client(timeout=60.0)

client = Anthropic(api_key=settings.anthropic_api_key, http_client=http_client)
```

**–í–µ—Ä—Å–∏–∏ httpx:**
- httpx < 0.28: –∏—Å–ø–æ–ª—å–∑—É–π `proxies=`
- httpx 0.28+: –∏—Å–ø–æ–ª—å–∑—É–π `proxy=`

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ httpx 0.25.2 ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º `proxies=`.

## –†–æ—Ç–∞—Ü–∏—è –ª–∏—á–Ω–æ–≥–æ –æ–ø—ã—Ç–∞

**–ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ (2026-01-28):** –õ–∏—á–Ω—ã–π –æ–ø—ã—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –≤ 1 –∏–∑ 4 –ø–æ—Å—Ç–æ–≤**.

### –õ–æ–≥–∏–∫–∞ —Ä–æ—Ç–∞—Ü–∏–∏

```python
# app/utils/post_types.py
def should_add_personal_experience() -> bool:
    """–î–æ–±–∞–≤–ª—è–µ–º –ª–∏—á–Ω—ã–π –æ–ø—ã—Ç –∫–∞–∂–¥—ã–π 4-–π –ø–æ—Å—Ç"""
    state = get_state()
    total_posts = len(state.get("history", []))
    position = (total_posts % 4) + 1
    return position == 4  # –ü–æ–∑–∏—Ü–∏–∏: 4, 8, 12, 16...
```

### –ü–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞

```python
# app/main.py
post_type_key, post_type_config = get_next_post_type()
post_data = await content_generator.generate_post(
    sources,
    post_type_instruction=post_type_config['prompt_addition'],
    add_cta=post_type_config.get('add_cta', False),
    cta_text=post_type_config.get('cta', ''),
    add_personal_experience=post_type_config.get('add_personal_experience', False)  # –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
)
```

### –£—Å–ª–æ–≤–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤ –ø—Ä–æ–º–ø—Ç–µ

```python
# app/agents/content_generator.py
if add_personal_experience:
    personal_experience_instruction = """–¢–≤–æ–π –ª–∏—á–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏–ª–∏ –æ–ø—ã—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∏–º–µ—Ä—ã –∏–∑ AUTHOR_EXPERIENCE_EXAMPLES"""
    author_experience_examples = AUTHOR_EXPERIENCE_EXAMPLES
else:
    personal_experience_instruction = """–¢–≤–æ—ë —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–µ –º–Ω–µ–Ω–∏–µ –∫–∞–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (–±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤)"""
    author_experience_examples = ""  # –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä—ã!

prompt = CONTENT_GENERATION_PROMPT.format(
    personal_experience_instruction=personal_experience_instruction,
    author_experience_examples=author_experience_examples,
    ...
)
```

**–í–∞–∂–Ω–æ:** –ü—Ä–∏–º–µ—Ä—ã `AUTHOR_EXPERIENCE_EXAMPLES` –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –¢–û–õ–¨–ö–û –∫–æ–≥–¥–∞ `add_personal_experience=True`.

## Content Generator Pattern

```python
# app/agents/content_generator.py
class ContentGenerator:
    async def generate_post(
        self,
        sources: List[Dict[str, Any]],
        post_type_instruction: str = "",
        add_cta: bool = False,
        cta_text: str = "",
        add_personal_experience: bool = False  # –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
    ) -> Dict[str, Any]:
        # 1. –ü–æ–¥–≥–æ—Ç–æ–≤—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏
        sources_text = self._prepare_sources_text(sources)

        # 2. –£—Å–ª–æ–≤–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ª–∏—á–Ω–æ–≥–æ –æ–ø—ã—Ç–∞
        if add_personal_experience:
            personal_experience_instruction = "...–∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∏–º–µ—Ä—ã –∏–∑ AUTHOR_EXPERIENCE_EXAMPLES"
            author_experience_examples = AUTHOR_EXPERIENCE_EXAMPLES
        else:
            personal_experience_instruction = "...—ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–µ –º–Ω–µ–Ω–∏–µ (–±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–µ–π—Å–æ–≤)"
            author_experience_examples = ""

        # 3. CTA-–±–ª–æ–∫ (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)
        if add_cta and cta_text:
            cta_instruction = f"""
–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –î–û–ë–ê–í–¨ CTA-–ë–õ–û–ö –í –ö–û–ù–¶–ï –ü–û–°–¢–ê:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
{cta_text}
"""
        else:
            cta_instruction = "–ë–ï–ó CTA-–ë–õ–û–ö–ê –≤ –∫–æ–Ω—Ü–µ –ø–æ—Å—Ç–∞."

        # 4. –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç
        prompt = CONTENT_GENERATION_PROMPT.format(
            sources=sources_text,
            post_type_instruction=post_type_instruction,
            cta_instruction=cta_instruction,
            personal_experience_instruction=personal_experience_instruction,
            author_experience_examples=author_experience_examples
        )

        # 5. –í—ã–∑–æ–≤–∏ Claude
        response = self.client.messages.create(
            model=self.model,
            max_tokens=2000,
            messages=[{"role": "user", "content": prompt}]
        )

        # 6. –û—á–∏—Å—Ç–∏ –æ—Ç —Å–ª—É–∂–µ–±–Ω—ã—Ö –º–µ—Ç–æ–∫
        cleaned = self._clean_post(response.content[0].text)

        return {'content': cleaned}
```

## –ü—Ä–æ–º–ø—Ç—ã (app/utils/prompts.py)

### –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø:** –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º—Å—è –∫–∞–∫ **—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–µ—à–µ–Ω–∏–π**, –∞ –Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á—É–∂–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

```python
CONTENT_GENERATION_PROMPT = """
–¢—ã ‚Äî –í–ª–∞–¥–∏–º–∏—Ä, —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∏—Å—Ç–µ–º –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤.
–£ —Ç–µ–±—è 5+ –ª–µ—Ç –æ–ø—ã—Ç–∞ —Ä–∞–±–æ—Ç—ã —Å API Ozon, Wildberries, –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç.

–¢–´ –†–ê–ó–†–ê–ë–ê–¢–´–í–ê–ï–®–¨ –†–ï–®–ï–ù–ò–Ø, –∞ –Ω–µ –≤–Ω–µ–¥—Ä—è–µ—à—å —á—É–∂–∏–µ.

–¢–í–û–Ø –≠–ö–°–ü–ï–†–¢–ò–ó–ê:
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å API (Ozon Seller API, Performance API, Wildberries API)
- ETL-–ø–∞–π–ø–ª–∞–π–Ω—ã –¥–ª—è —Å–±–æ—Ä–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–æ–≤ –∏ –æ—Ç—á—ë—Ç–æ–≤
- –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤

{author_experience_examples}

–ó–ê–ü–†–ï–©–ï–ù–û:
- –£–ø–æ–º–∏–Ω–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã (Seller Mate, –∏ —Ç.–¥.)
- –ü–∏—Å–∞—Ç—å —Ç–∞–∫, –±—É–¥—Ç–æ —Ç—ã –≤–Ω–µ–¥—Ä—è–µ—à—å —á—É–∂–∏–µ —Ä–µ—à–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–æ–≤–∞ "—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª —Å–µ—Ä–≤–∏—Å X", "–∏—Å–ø–æ–ª—å–∑—É—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç Y"

–†–ê–ó–†–ï–®–ï–ù–û:
- –ì–æ–≤–æ—Ä–∏—Ç—å –ø—Ä–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É —Å–≤–æ–∏—Ö —Ä–µ—à–µ–Ω–∏–π
- –î–µ–ª–∏—Ç—å—Å—è –æ–ø—ã—Ç–æ–º —Ä–∞–±–æ—Ç—ã —Å API
- –û–±—ä—è—Å–Ω—è—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã

–°–¢–†–£–ö–¢–£–†–ê –ü–û–°–¢–ê:
1. –¶–µ–ø–ª—è—é—â–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
2. –°—É—Ç—å –Ω–æ–≤–æ—Å—Ç–∏ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
3. {personal_experience_instruction}
4. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–ª—å–∑–∞ –¥–ª—è —Å–µ–ª–ª–µ—Ä–æ–≤
5. –í–æ–ø—Ä–æ—Å –∫ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –∏–ª–∏ –ø—Ä–∏–∑—ã–≤

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
- –î–ª–∏–Ω–∞: 400-700 —Å–∏–º–≤–æ–ª–æ–≤ (–±–µ–∑ —É—á—ë—Ç–∞ CTA-–±–ª–æ–∫–∞)
- –ù–ï –ø–∏—à–∏ "–ü–û–°–¢:", "–¢–ï–ì–ò:", "---", "–ó–∞–≥–æ–ª–æ–≤–æ–∫:"
- –ë–ï–ó –•–ï–®–¢–ï–ì–û–í
- –ü–∏—à–∏ –∫–∞–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, –∞ –Ω–µ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á—É–∂–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

{cta_instruction}

{post_type_instruction}

–ù–∞–ø–∏—à–∏ –ø–æ—Å—Ç –°–¢–†–û–ì–û –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –≤—ã—à–µ:
"""
```

### –ü—Ä–∏–º–µ—Ä—ã –ª–∏—á–Ω–æ–≥–æ –æ–ø—ã—Ç–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è 1 –∏–∑ 4 –ø–æ—Å—Ç–æ–≤)

```python
AUTHOR_EXPERIENCE_EXAMPLES = """
–ü–†–ò–ú–ï–†–´ –õ–ò–ß–ù–û–ì–û –û–ü–´–¢–ê (–¢–û–õ–¨–ö–û –µ—Å–ª–∏ add_personal_experience=True):

–ü—Ä–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É:
- "–ù–µ–¥–∞–≤–Ω–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å Ozon API ‚Äî —ç–∫–æ–Ω–æ–º–∏—Ç 3-4 —á–∞—Å–∞ –≤ –¥–µ–Ω—å"
- "–ù–∞ –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–µ –∑–∞–ø—É—Å—Ç–∏–ª –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Performance API ‚Äî –∫–ª–∏–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å –≤–∏–¥–∏—Ç –≤—Å—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –≤ –æ–¥–Ω–æ–º –¥–∞—à–±–æ—Ä–¥–µ"
- "–û–¥–∏–Ω –∏–∑ –º–æ–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ —Ç–µ—Ä—è–ª 50–ö –∏–∑-–∑–∞ —Ä—É—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –æ—Å—Ç–∞—Ç–∫–æ–≤. –ù–∞–ø–∏—Å–∞–ª —Å–∫—Ä–∏–ø—Ç ‚Äî –ø—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞"

–ü—Ä–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—É:
- "–ü–æ –æ–ø—ã—Ç—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, 80% —Å–µ–ª–ª–µ—Ä–æ–≤ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç —ç—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏ –≤ API. –ò –∑—Ä—è"
- "–ó–Ω–∞–∫–æ–º–∞—è —Å–∏—Ç—É–∞—Ü–∏—è: –∫–ª–∏–µ–Ω—Ç –ø—Ä–∏—à—ë–ª —Å 'API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', –∞ —Ç–∞–º –ø—Ä–æ—Å—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è"
- "–í—á–µ—Ä–∞ —Ä–∞–∑–±–∏—Ä–∞–ª —Ç–∞–∫–æ–π –∫–µ–π—Å: —Å–µ–ª–ª–µ—Ä —Å 2000 SKU –æ–±–Ω–æ–≤–ª—è–ª —Ü–µ–Ω—ã –≤—Ä—É—á–Ω—É—é ‚Äî 6 —á–∞—Å–æ–≤ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ"
"""
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ:** –≠—Ç–∏ –ø—Ä–∏–º–µ—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –ø—Ä–æ–º–ø—Ç –¢–û–õ–¨–ö–û –∫–æ–≥–¥–∞ `add_personal_experience=True`.

### –¢–∏–ø—ã –ø–æ—Å—Ç–æ–≤ (post_type_instruction)

| –¢–∏–ø | –§–æ—Ä–º–∞—Ç |
|-----|--------|
| –ü–æ–ª–µ–∑–Ω–∞—è –ø–æ–ª—å–∑–∞ | –ü—Ä–æ–±–ª–µ–º–∞ ‚Üí –†–µ—à–µ–Ω–∏–µ ‚Üí –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å |
| –ö–µ–π—Å | –ë—ã–ª–æ ‚Üí –°–¥–µ–ª–∞–ª–∏ ‚Üí –°—Ç–∞–ª–æ (—Å —Ü–∏—Ñ—Ä–∞–º–∏!) |
| –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤ | –ù–æ–≤–æ—Å—Ç—å ‚Üí –¢–≤–æ—ë –º–Ω–µ–Ω–∏–µ ‚Üí –í–æ–ø—Ä–æ—Å –∞—É–¥–∏—Ç–æ—Ä–∏–∏ |

### –ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤ –≤—ã–≤–æ–¥–µ

| –ü–∞—Ç—Ç–µ—Ä–Ω | –ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ |
|---------|--------------|
| `–ü–û–°–¢:` | –í—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –±–æ—Ç |
| `–¢–ï–ì–ò:` | –í—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –±–æ—Ç |
| `–ó–∞–≥–æ–ª–æ–≤–æ–∫:` | –°–ª—É–∂–µ–±–Ω–∞—è –º–µ—Ç–∫–∞ |
| `---` | –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ –Ω–µ –Ω—É–∂–Ω—ã |
| `–ò–°–¢–û–ß–ù–ò–ö–ò:` | –ù–µ –¥–ª—è –∫–æ–Ω–µ—á–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ |
| `{placeholder}` | –ù–µ–∑–∞–º–µ–Ω–µ–Ω–Ω—ã–π –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä |

## –†–æ—Ç–∞—Ü–∏—è CTA

CTA –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ **2 –∏–∑ 3 –ø–æ—Å—Ç–æ–≤** (–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π 3-–π).

```python
def should_add_cta() -> bool:
    state = get_state()
    total_posts = len(state.get("history", []))
    position = (total_posts % 3) + 1
    return position != 3  # –ù–µ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∫–∞–∂–¥—ã–π 3-–π
```

**CTA Pool (–≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ):**
- "üí° –ù—É–∂–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞? –û—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É ‚Üí https://t.me/smart_analytics_mp_bot"
- "üìä –•–æ—Ç–∏—Ç–µ —Ç–∞–∫–∏–µ –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã? –û—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É ‚Üí https://t.me/smart_analytics_mp_bot"
- "üí¨ –ï—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã? –ù–∞–ø–∏—à–∏—Ç–µ –≤ –±–æ—Ç ‚Üí https://t.me/smart_analytics_mp_bot"
- "üì≤ –û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É ‚Üí https://t.me/smart_analytics_mp_bot"

## –û—á–∏—Å—Ç–∫–∞ –≤—ã–≤–æ–¥–∞

```python
def _clean_post(self, text: str) -> str:
    import re
    # –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏
    text = re.sub(r"^-+\s*", "", text, flags=re.MULTILINE)
    text = re.sub(r"\s*-+$", "", text, flags=re.MULTILINE)

    # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∫–∏
    text = re.sub(
        r"^(–ü–û–°–¢|POST|–ö–û–ù–¢–ï–ù–¢|CONTENT|–¢–ï–ì–ò|TAGS|–ò–°–¢–û–ß–ù–ò–ö–ò|SOURCES|–•–ï–®–¢–ï–ì–ò):\s*",
        "", text, flags=re.MULTILINE | re.IGNORECASE
    )

    # –£–±–∏—Ä–∞–µ–º –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—Ä–∞–∑—ã Claude
    text = re.sub(
        r"^(–í–æ—Ç —á—Ç–æ —è –Ω–∞–ø–∏—Å–∞–ª|–í–æ—Ç –ø–æ—Å—Ç|–ì–æ—Ç–æ–≤–æ|–ö–æ–Ω–µ—á–Ω–æ|–•–æ—Ä–æ—à–æ).{0,100}?:\s*\n+",
        "", text, flags=re.IGNORECASE
    )

    return text.strip()
```

## –ú–æ–¥–µ–ª–∏

| –ú–æ–¥–µ–ª—å | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|--------|---------------|
| `claude-3-haiku-20240307` | Production (–±—ã—Å—Ç—Ä–æ, –¥—ë—à–µ–≤–æ) |
| `claude-3-5-sonnet-20241022` | –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∫–∞—á–µ—Å—Ç–≤–æ |
| `claude-sonnet-4-5-20250929` | –ù–æ–≤–µ–π—à–∞—è (–ø—Ä–æ–≤–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å) |

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```python
try:
    response = self.client.messages.create(...)
except anthropic.APIError as e:
    if "403" in str(e):
        logger.error("Proxy –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–ª–∏ API –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω")
    elif "529" in str(e):
        logger.warning("Claude API –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω, –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ 10 —Å–µ–∫")
    raise
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
python test_publish.py  # –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–ª–∞–≥–∏ CTA –∏ –ª–∏—á–Ω–æ–≥–æ –æ–ø—ã—Ç–∞

# –¢–µ—Å—Ç —Ä–æ—Ç–∞—Ü–∏–∏
python test_rotation_clean.py  # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ—Ç–∞—Ü–∏—é –Ω–∞ 16 –ø–æ—Å—Ç–∞—Ö
```

## Verification Checklist

–ü–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π –ø—Ä–æ–≤–µ—Ä—å:

- [ ] –ù–µ—Ç —Å–ª—É–∂–µ–±–Ω—ã—Ö –º–µ—Ç–æ–∫ ("–ü–û–°–¢:", "–ó–∞–≥–æ–ª–æ–≤–æ–∫:")
- [ ] CTA-–±–ª–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω (–µ—Å–ª–∏ `add_cta=True`)
- [ ] –õ–∏—á–Ω—ã–π –æ–ø—ã—Ç –µ—Å—Ç—å –¢–û–õ–¨–ö–û –µ—Å–ª–∏ `add_personal_experience=True`
- [ ] –ù–µ—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–π Seller Mate –∏ –¥—Ä—É–≥–∏—Ö —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–µ—à–µ–Ω–∏–π
- [ ] –î–ª–∏–Ω–∞ 400-700 —Å–∏–º–≤–æ–ª–æ–≤ (–±–µ–∑ CTA)
